<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="/home/sakurai/lib/github-markdown.css" type="text/css" />
</head>
<body>
<div id="TOC">
<ul>
<li><a href="#elparser">Elparser</a><ul>
<li><a href="#sample-code">Sample code</a><ul>
<li><a href="#parsing-s-exp-and-getting-javascript-objects">Parsing S-exp and getting JavaScript objects</a></li>
<li><a href="#encoding-javascript-objects-into-s-exp">Encoding JavaScript objects into S-exp</a></li>
</ul></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#api-document">API Document</a><ul>
<li><a href="#parser">Parser</a></li>
<li><a href="#encoder">Encoder</a></li>
<li><a href="#object-mapping">Object Mapping</a></li>
</ul></li>
<li><a href="#license">License</a></li>
</ul></li>
</ul>
</div>
<h1 id="elparser">Elparser</h1>
<p><a href="http://badge.fury.io/js/elparser"><img src="https://badge.fury.io/js/elparser.svg" alt="npm version" /></a></p>
<p>A parser for S-expression of emacs lisp and some utilities.</p>
<h2 id="sample-code">Sample code</h2>
<h3 id="parsing-s-exp-and-getting-javascript-objects">Parsing S-exp and getting JavaScript objects</h3>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> elparser = <span class="fu">require</span>(<span class="st">&#39;elparser&#39;</span>);

<span class="co">// list and literals</span>
<span class="kw">var</span> obj1 = <span class="ot">elparser</span>.<span class="fu">parse1</span>(<span class="st">&quot;(1 2.3 a </span><span class="ch">\&quot;</span><span class="st">b</span><span class="ch">\&quot;</span><span class="st"> () (c &#39;d))&quot;</span>);

<span class="ot">console</span>.<span class="fu">log</span>(<span class="ot">obj1</span>.<span class="fu">toJS</span>());
<span class="co">// =&gt; [ 1, 2.3, &#39;a&#39;, &#39;b&#39;, null, [ &#39;c&#39;, [ &#39;d&#39; ] ] ]</span>


<span class="co">// alist and hash</span>
<span class="kw">var</span> obj2 = <span class="ot">elparser</span>.<span class="fu">parse1</span>(<span class="st">&quot;( (a . 1) (b . </span><span class="ch">\&quot;</span><span class="st">xxx</span><span class="ch">\&quot;</span><span class="st">) (c 3 4) (</span><span class="ch">\&quot;</span><span class="st">d</span><span class="ch">\&quot;</span><span class="st"> . </span><span class="ch">\&quot;</span><span class="st">e</span><span class="ch">\&quot;</span><span class="st">))&quot;</span>);

<span class="ot">console</span>.<span class="fu">log</span>(<span class="ot">obj2</span>.<span class="fu">toJS</span>());
<span class="co">// =&gt; [ [ &#39;a&#39;, 1 ], [ &#39;b&#39;, &#39;xxx&#39; ], [ &#39;c&#39;, 3, 4 ], [ &#39;d&#39;, &#39;e&#39; ] ]</span>

<span class="ot">console</span>.<span class="fu">log</span>(<span class="ot">obj2</span>.<span class="fu">toObject</span>());
<span class="co">// =&gt; { a: 1, b: &#39;xxx&#39;, c: [ 3, 4 ], d: &#39;e&#39; }</span></code></pre>
<h3 id="encoding-javascript-objects-into-s-exp">Encoding JavaScript objects into S-exp</h3>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="ot">elparser</span>.<span class="fu">encode</span>([<span class="dv">1</span>,<span class="fl">1.2</span>,-<span class="dv">4</span>,<span class="st">&quot;xxx&quot;</span>,[www],<span class="kw">true</span>,<span class="kw">null</span>])
<span class="co">// =&gt; &quot;(1 1.2 -4 \&quot;xxx\&quot; www t nil)&quot;</span>
 
<span class="ot">elparser</span>.<span class="fu">encode</span>({<span class="dt">a</span>:[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>], <span class="dt">b</span>:{<span class="dt">c</span>:[<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]}})
<span class="co">// =&gt; &quot;((a 1 2 3) (b (c 4 5 6)))&quot;</span></code></pre>
<h2 id="installation">Installation</h2>
<p>Add this line to your application's package.json:</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">   <span class="st">&quot;dependencies&quot;</span>: {
       <span class="st">&quot;elparser&quot;</span>: <span class="st">&quot;*&quot;</span>
   }</code></pre>
<p>And then execute:</p>
<pre><code>$ npm install</code></pre>
<p>Or install it yourself as:</p>
<pre><code>$ npm install elparser</code></pre>
<h2 id="api-document">API Document</h2>
<h3 id="parser">Parser</h3>
<p>The module <code>elparser</code> is parser for emacs-lisp S-expression. The user program creates an instance of the class and parses the S-exp string with <code>parse1</code> method. If the source string has multiple S-expressions, one can use <code>parse</code> method.</p>
<p>If the <code>elparser.parse1</code> method succeeds in parsing the given S-exp string, it returns a <code>SExp</code> object which is AST of S-exp. Invoking <code>toJS</code> method of the <code>SExp</code> object, one can obtain a JavaScript object. <code>elparser.parse</code> method returns an array of <code>SExp</code> objects.</p>
<p>The <code>SExp</code> objects are instances of <code>SExpXXX</code> classes: <code>SExpNumber</code>, <code>SExpString</code>, <code>SExpSymbol</code>, <code>SExpNil</code>, <code>SExpCons</code>, <code>SExpList</code>, <code>SExpListDot</code> and <code>SExpQuoted</code>. Each classes represent corresponding S-exp objects.</p>
<p>If the given S-exp list is an alist, invoking <code>SExpList.toObject</code> method, a JavaScript <code>Object</code> instance can be obtained.</p>
<h3 id="encoder">Encoder</h3>
<p>The module method <code>elparser.encode</code> encodes the JavaScript objects into elisp S-expressions. The another method <code>elparser.encodeMulti</code> receives an array of JavaScript objects and returns a S-expression string in which multiple S-expressions are concatenated.</p>
<p>If an object which is not defined in serialization rules is given, this method raises an exception with some messages. See the next section for the encoding detail.</p>
<h3 id="object-mapping">Object Mapping</h3>
<p>The primitive objects are translated straightforwardly.</p>
<h4 id="decoding-s-expression---javascript">Decoding (S-expression -&gt; JavaScript)</h4>
<p>A quoted expression is translated to an array. Both <code>nil</code> and <code>()</code> are translated to <code>null</code>. Cons cells and lists are translated to arrays.</p>
<table>
<thead>
<tr class="header">
<th align="left">type</th>
<th align="left">S-exp (input)</th>
<th align="left">JavaScript (output)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">integer</td>
<td align="left"><code>1</code></td>
<td align="left"><code>1</code></td>
</tr>
<tr class="even">
<td align="left">float</td>
<td align="left"><code>1.2</code></td>
<td align="left"><code>1.2</code></td>
</tr>
<tr class="odd">
<td align="left">float</td>
<td align="left"><code>1e4</code></td>
<td align="left"><code>1e4</code></td>
</tr>
<tr class="even">
<td align="left">float</td>
<td align="left"><code>.45</code></td>
<td align="left"><code>.45</code></td>
</tr>
<tr class="odd">
<td align="left">symbol</td>
<td align="left"><code>abc</code></td>
<td align="left"><code>&quot;abc&quot;</code></td>
</tr>
<tr class="even">
<td align="left">string</td>
<td align="left"><code>&quot;abc&quot;</code></td>
<td align="left"><code>&quot;abc&quot;</code></td>
</tr>
<tr class="odd">
<td align="left">quote</td>
<td align="left"><code>'abc</code></td>
<td align="left"><code>[&quot;abc&quot;]</code></td>
</tr>
<tr class="even">
<td align="left">null</td>
<td align="left"><code>nil</code></td>
<td align="left"><code>null</code></td>
</tr>
<tr class="odd">
<td align="left">empty list</td>
<td align="left"><code>()</code></td>
<td align="left"><code>null</code></td>
</tr>
<tr class="even">
<td align="left">list</td>
<td align="left"><code>(1 2)</code></td>
<td align="left"><code>[1,2]</code></td>
</tr>
<tr class="odd">
<td align="left">nest list</td>
<td align="left"><code>(a (b))</code></td>
<td align="left"><code>[&quot;a&quot; [&quot;b&quot;]]</code></td>
</tr>
<tr class="even">
<td align="left">cons cell</td>
<td align="left"><code>(a . b)</code></td>
<td align="left"><code>[&quot;a&quot;,&quot;b&quot;]</code></td>
</tr>
<tr class="odd">
<td align="left">dot list</td>
<td align="left"><code>(a b . d)</code></td>
<td align="left"><code>[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]</code></td>
</tr>
<tr class="even">
<td align="left">alist(<code>toJS</code>)</td>
<td align="left"><code>((a . 1) (b . 2))</code></td>
<td align="left"><code>[[&quot;a&quot;,1],[&quot;b&quot;,2]]</code></td>
</tr>
<tr class="odd">
<td align="left">alist(<code>toObject</code>)</td>
<td align="left"><code>((a . 1) (b . 2))</code></td>
<td align="left"><code>{&quot;a&quot;:1,&quot;b&quot;:2}</code></td>
</tr>
<tr class="even">
<td align="left">alist list</td>
<td align="left"><code>((a 1 2) (b . 3))</code></td>
<td align="left"><code>{&quot;a&quot;:[1,2],&quot;b&quot;:3}</code></td>
</tr>
</tbody>
</table>
<h4 id="encoding-javascript---s-expression">Encoding (JavaScript -&gt; S-expression)</h4>
<p>The Array and Object instances are translated to lists and alist respectively.</p>
<table>
<thead>
<tr class="header">
<th align="left">type</th>
<th align="left">JavaScript (input)</th>
<th align="left">S-exp (output)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">primitive</td>
<td align="left"><code>[1,1.2,-4,&quot;xxx&quot;,true,null]</code></td>
<td align="left"><code>(1 1.2 -4 &quot;xxx&quot; t nil)</code></td>
</tr>
<tr class="even">
<td align="left">empty list</td>
<td align="left"><code>[]</code></td>
<td align="left"><code>nil</code></td>
</tr>
<tr class="odd">
<td align="left">nest list</td>
<td align="left"><code>[1,[2,[3,4]]]</code></td>
<td align="left"><code>(1 (2 (3 4)))</code></td>
</tr>
<tr class="even">
<td align="left">hash</td>
<td align="left"><code>{&quot;a&quot;:&quot;b&quot;, &quot;c&quot;:&quot;d&quot;}</code></td>
<td align="left"><code>((&quot;a&quot; . &quot;b&quot;) (&quot;c&quot; . &quot;d&quot;))</code></td>
</tr>
<tr class="odd">
<td align="left">hash</td>
<td align="left"><code>{&quot;a&quot;:[1,2,3], &quot;b&quot;:{&quot;c&quot;:[4,5,6]}}</code></td>
<td align="left"><code>((&quot;a&quot; 1 2 3) (&quot;b&quot; (&quot;c&quot; 4 5 6)))</code></td>
</tr>
</tbody>
</table>
<h5 id="exception">Exception</h5>
<p>The encoding functions, <code>encode</code> and <code>encodeMulti</code> receive a boolean parameter as <code>throwException</code>. If <code>throwException</code> is true, these functions throw <code>SerializationError</code> for wrong objects which are not defined in the serialization rules. If the parameter is false or omitted, these functions translate wrong objects by <code>toString</code> without any exception.</p>
<h5 id="using-s-expression-ast">Using S-expression AST</h5>
<p>Symbol, Cons cells and quoted expressions can't be expressed by any JavaScript object. If those S-expressions are needed, one can obtain such S-expressions with creating AST instances of <code>SExpCons</code> and <code>SExpQuoted</code> directly.</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> elparser = <span class="fu">require</span>(<span class="st">&#39;elparser&#39;</span>);
<span class="kw">var</span> ast   = <span class="ot">elparser</span>.<span class="fu">ast</span>;
<span class="kw">var</span> msym  = <span class="ot">ast</span>.<span class="fu">SExpSymbol</span>;
<span class="kw">var</span> mcons = <span class="ot">ast</span>.<span class="fu">SExpCons</span>;
<span class="kw">var</span> mnum  = <span class="ot">ast</span>.<span class="fu">SExpNumber</span>;
<span class="ot">elparser</span>.<span class="fu">encode</span>([<span class="dv">1</span>, <span class="kw">new</span> <span class="fu">msym</span>(<span class="st">&quot;abc&quot;</span>), <span class="kw">new</span> <span class="fu">mcons</span>(<span class="kw">new</span> <span class="fu">msym</span>(<span class="st">&quot;a&quot;</span>), <span class="ot">mnum</span>.<span class="fu">intVal</span>(<span class="dv">2</span>))]);
<span class="co">// =&gt; &quot;(1 abc (a . 2))&quot;</span></code></pre>
<h2 id="license">License</h2>
<p>Copyright (c) 2015 SAKURAI Masashi Released under the MIT license</p>
</body>
</html>
